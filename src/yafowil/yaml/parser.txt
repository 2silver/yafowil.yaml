Form definition with 2 fields::

    >>> raw = """
    ... factory: form
    ... name: demoform
    ... props:
    ...     action: demoaction
    ... widgets:
    ... - firstfield:
    ...     factory: field:label:error:text
    ...     value: context.firstfield_value
    ...     properties:
    ...         label: First Field
    ...         description: I am the description
    ...         required: I am required
    ... - secondfield:
    ...     factory: field:label:*custom_stuff:error:select
    ...     value: ['a', 'b']
    ...     properties:
    ...         label: Second Field
    ...         multivalued: True
    ...         vocabulary: yafowil.yaml.tests.test_vocab
    ...     custom:
    ...         custom_stuff:
    ...             extractors:
    ...                 - context.custom_extractor_1
    ...                 - context.custom_extractor_2
    ...             renderers: context.custom_renderer
    ...             preprocessors: context.custom_preprocessor
    ...             builders: context.custom_builder
    ... """

Check how yaml parses this::

    >>> import yaml
    >>> pprint(yaml.load(raw))
    {'factory': 'form',
     'name': 'demoform',
     'props': {'action': 'demoaction'},
     'widgets': [{'firstfield': {'factory': 'field:label:error:text',
                                 'properties': {'description': 'I am the description',
                                                'label': 'First Field',
                                                'required': 'I am required'},
                                 'value': 'context.firstfield_value'}},
                 {'secondfield': {'custom': {'custom_stuff': {'builders': 'context.custom_builder',
                                                              'extractors': ['context.custom_extractor_1',
                                                                             'context.custom_extractor_2'],
                                                              'preprocessors': 'context.custom_preprocessor',
                                                              'renderers': 'context.custom_renderer'}},
                                  'factory': 'field:label:*custom_stuff:error:select',
                                  'properties': {'label': 'Second Field',
                                                 'multivalued': True,
                                                 'vocabulary': 'yafowil.yaml.tests.test_vocab'},
                                  'value': ['a', 'b']}}]}

Create tmp env::

    >>> import os
    >>> import tempfile
    >>> tempdir = tempfile.mkdtemp()
    >>> template_path = os.path.join(tempdir, 'tmpl.yaml')
    >>> with open(template_path, 'w') as file:
    ...     file.write(raw)
    
    >>> trash_path = os.path.join(tempdir, 'trash.yaml')
    >>> with open(trash_path, 'w') as file:
    ...     file.write("{]")

Create dummy context::

    >>> class DummyContext(object):
    ...     def firstfield_value(widget, data):
    ...         return 'First value'
    
    >>> context = DummyContext()

Test YamlParser for yafowil forms::

    >>> from yafowil.yaml import YAMLParser

    >>> YAMLParser('inexistent_path', context=context)()
    Traceback (most recent call last):
      ...
    YAMLTransformationError: File not found: 'inexistent_path'
    
    >>> YAMLParser(trash_path, context=context)()
    Traceback (most recent call last):
      ...
    YAMLTransformationError: Cannot parse YAML from given path '...trash.yaml'
    
    >>> parser = YAMLParser(template_path, context=context)
    >>> parser
    <yafowil.yaml.parser.YAMLParser object at ...>
    
    >>> parser.path
    '...tmpl.yaml'
    
    >>> parser.context
    <DummyContext object at ...>

Parse definition values. If definition is a string.

    >>> parser.parse_definition_value(object())
    <object object at ...>
    
    >>> parser.parse_definition_value('foo')
    'foo'
    
    >>> parser.parse_definition_value('yafowil.yaml.tests.test_vocab')
    <function test_vocab at ...>
    
    >>> parser.parse_definition_value('context.firstfield_value')
    <function firstfield_value at ...>
    
    >>> parser.parse_definition_value('yafowil.inexistent')
    'yafowil.inexistent'
    
    >>> parser.parse_definition_value('context.inexistent')
    'context.inexistent'

    >>> from yafowil.yaml import parse_from_YAML
    >>> form = parse_from_YAML(template_path, context)
    >>> form
    <Widget object 'demoform' at ...>
    
    >>> form.printtree()
    <class 'yafowil.base.Widget'>: demoform
      <class 'yafowil.base.Widget'>: firstfield
      <class 'yafowil.base.Widget'>: secondfield
